<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hs.meetme.notice.mapper.NoticeMapper">

<select id="getNoticeList" resultType="NoticeVO">
	SELECT *
	FROM NOTIFICATION
	WHERE USER_RECEIVED = #{userReceived}
	ORDER BY notice_date DESC
</select>

<select id="coupleRequest" resultType="NoticeVO">
	SELECT U.NAME,
			U.IMG_URL,
			N.*
	FROM NOTIFICATION N
	JOIN (SELECT US.NAME,
				 I.IMG_URL,
				 US.USER_ID AS USER_ID
	        FROM USER_INFO US
	        JOIN IMG I
	        ON US.IMG_ID = I.IMG_ID) U
	ON U.USER_ID = N.USER_SENT
	WHERE N.USER_RECEIVED=#{userReceived}
	AND N.POST_ID IS NULL
	ORDER BY N.NOTICE_DATE DESC
</select>

<delete id="deleteNotice" parameterType="NoticeVO">
  DELETE
  FROM NOTIFICATION
  WHERE notice_id = #{noticeId}
</delete>
	<insert id="insertNotice">
	<selectKey keyProperty="coupleId" resultType="String" order="BEFORE">
		SELECT SEQ_NOTICE.NEXTVAL FROM DUAL
	</selectKey>
	INSERT INTO NOTIFICATION(NOTICE_ID,
							USER_SENT,
							USER_RECEIVED,
							NOTICE_CONTENT,
							NOTICE_DATE,
							NOTICE_CONFIRMED)
			VALUES(#{noticeId},
					#{userSent},
					#{userReceived},
					#{noticeContent},
					SYSDATE,
					#{noticeConfirmed})
	</insert> 

</mapper>