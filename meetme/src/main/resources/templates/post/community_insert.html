<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="~{layout/layout}">
<!-- 컨텐츠페이지의 CSS 영역이 들어감 -->
    <th:block layout:fragment="css">
		<style>
			.container{
						background-color:white;
					}
		</style>
	</th:block>
		
		
		<th:block layout:fragment="content">
		    <!-- 여기에 body에 들어갈 내용을 적어주세요 -->
		    <div class="container" >
		    <br>
		    	<div>
			    	<h2>커뮤니티 글쓰기</h2>
		    	</div>
		    <br>
		  	<div class="card-content">
			<form class="form-horizontal form-view" th:action="@{/post/insertCommunity}" th:object="${list}" method="get">
				<div class="form-group">
					<label for="inp-type-1" class="col-sm-2 control-label">제목</label>
					<div class="col-sm-10">
						<input type="hidden" th:id="userId" th:name="userId" th:value="${session.userSession.userId}">
						<input type="text" th:id="postTitle" th:name="postTitle">
					</div>
				</div>

			
				<div class="form-group">
					<label for="inp-type-5" class="col-sm-2 control-label">내용</label>
					
					<div class="col-sm-10">
						<input th:name="${_csrf.parameterName}" type="hidden" th:value="${_csrf.token}">
						<textarea name="postContent" class="form-control" id="ckcontents"></textarea>
					</div>
					
				</div>
			<div class="row mt-3"> 
				<div class="col-auto mr-auto">
				</div> 
				<div class="col-auto"> 
					<button type = "submit" name = "submit" id="btnSave" class="btn btn-primary">저장</button> 
					<button id="btnCancel" class="btn btn-light">취소</button> 
				</div> 
			</div>

			</form>

		</div>	
		</div>
		<!-- /.card-content -->
		    
		</th:block>
		<th:block layout:fragment="script">
			<script src="/js/ckeditor/ckeditor.js"></script>
			<script type="text/javascript" th:inline="javascript">
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) { xhr.setRequestHeader(header, token); });
			/*<![CDATA[*/ 
			$(function() { 
				CKEDITOR.replace('ckcontents',{ 
					filebrowserUploadUrl: '/post/ckeditor/fileUpload', 
					font_names : "맑은 고딕/Malgun Gothic;굴림/Gulim;돋움/Dotum;바탕/Batang;궁서/Gungsuh;Arial/Arial;Comic Sans MS/Comic Sans MS;Courier New/Courier New;Georgia/Georgia;Lucida Sans Unicode/Lucida Sans Unicode;Tahoma/Tahoma;Times New Roman/Times New Roman;MS Mincho/MS Mincho;Trebuchet MS/Trebuchet MS;Verdana/Verdana",
					font_defaultLabel : "맑은 고딕/Malgun Gothic", 
					fontSize_defaultLabel : "12", 
					// skin : "office2013", 
					language : "ko" 
				}); 
				// ... 
			});
			 // ... 
			 function saveGallery() { 
				 if (!confirm("저장하시겠습니까?")) { 
					 return; 
					} 
					var formData = new FormData($("form")[0]); 
					formData.append("deleteFiles", deleteFileList); 
					formData.set("contents", CKEDITOR.instances.contents.getData()); 
					for (var i = 0; i < inputFileList.length; i++) {
						 if(!inputFileList[i].is_delete){
							  formData.append("files", inputFileList[i]);
							 } } 
							 for (var pair of formData.entries()) { 
								 console.log(pair[0]+ ', ' + pair[1]); 
								}
								 $.ajax({ 
									 type : "POST", 
									 enctype : "multipart/form-data", 
									 url : "/gallery", 
									 data : formData, 
									 dataType:"json", 
									 processData : false, 
									 contentType : false, 
									 success : function(result) { 
										 if (result.response == "OK") {
											  if ($("#id").val() == undefined) { 
												  alert("저장되었습니다."); 
												} else { 
													alert("수정되었습니다."); } 
													location.href = "/gallery/" + result.galleryId;
												 } else { 
													 alert(result.errorMsg); 
													} 
												},
											 });
											 } 
											 /*]]>*/

										</script>

		</th:block>
</html>