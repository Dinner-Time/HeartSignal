<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorator="~{layout/layout}">

<th:block layout:fragment="css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css">
  <style>

  </style>
</th:block>

<th:block layout:fragment="content">
			<div class="tm-page-wrap mx-auto">
			<section class="p-5 tm-container-outer tm-bg-white">
				<div class="container">
					<div class="row">
	  

	  
	  
	  
	<form id ="actionForm" action="" method="get">
	  <select name="category" class="custom-select">
	    <option value="A" th:selected="${#strings.equals(pageMaker.cri.category,'A')}">전체보기</option>
	    <option value="B" th:selected="${#strings.equals(pageMaker.cri.category,'B')}">내가만든</option>
	    <option value="C" th:selected="${#strings.equals(pageMaker.cri.category,'C')}">넘이만든</option>
	  </select>
	  <select name = "type" class="custom-select">
	    <option value=""  th:selected="${#strings.isEmpty(pageMaker.cri.type)}">선택</option>
	    <option value="T" th:selected="${#strings.equals(pageMaker.cri.type, 'T')}">제목</option>
	    <option value="C" th:selected="${#strings.equals(pageMaker.cri.type, 'C')}">내용</option>
	    <option value="TC" th:selected="${#strings.equals(pageMaker.cri.type,'TC')}">제목 또는 내용</option>	  
	  </select>
	  <input name="keyword" th:value="${pageMaker.cri.keyword}">
	  <button class="btn btn-default" onclick="$('[name=pageNum]').val(1)">검색</button>
	  <input type="hidden" name="pageNum" th:value="${pageMaker.cri.pageNum}">
	  <input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
	</form>

	<div class ="pull-right">
	  <ul class ="pagination">  
	    <li th:if="${pageMaker.prev }" class="page-item">
	    	<a class="page-link" th:href="${pageMaker.startPage-1}" th:text="'이전'"></a>
	    </li>
	    
	    <th:block th:each="num: ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}" >
	      <li class="page-item">
	      <a class="page-link" th:href="${num}" th:text="${num}"></a>
	      </li>
	    </th:block>
	    
	    <li th:if="${pageMaker.next }" class="page-item">
	    	<a class="page-link" th:href="${pageMaker.endPage+1}" th:text="'다음'"></a>
	    </li>
	  </ul>
	</div>
	  	

		<!-- Tab 4 -->
		<div class="tab-pane fade show active">
			<!-- 카드1 -->
			<div>
				<th:block th:each="c: ${#numbers.sequence(0,list.size-1)}">
					<!-- (0,course.size-1) -->
					<!-- Current Active Tab WITH "show active" classes in DIV tag -->
					<div class="tm-recommended-place-wrap">
						<div class="tm-recommended-place">
							<img src="img/tm-img-06.jpg" alt="Image"
								class="img-fluid tm-recommended-img">
							<div class="tm-recommended-description-box">
								<br>
								<h3 class="tm-recommended-title"
									th:text="${list[c].courseName}"></h3>
									
								<span th:if="${list[c].userId==session.userSession.userId }" class="badge rounded-pill bg-info text-warning">나의코스</span>
								<span th:if="${list[c].userId!=session.userSession.userId }" class="badge rounded-pill bg-info text-danger">스크랩</span>
								<!-- 코스 -->
								<br>
								<p class="tm-text-highlight" th:text="${list[c].region}" style="font-size: 15px;"></p>
								<p class="tm-text-gray"></p>
								<th:block th:each="d: ${#numbers.sequence(0,detail.size-1)}">
								  <i th:if="${list[c].courseId==detail[d].courseId}" th:text="${detail[d].placeName}"></i>
								</th:block>
							</div>
							<!-- <a href="#" class="tm-recommended-price-box"> -->
							<div class="tm-recommended-price-box">
								<p class="tm-recommended-price-link" style="font-size: 15px;">평균비용</p>
								<p class="tm-recommended-price" th:text="'₩ '+${list[c].sumCost}" style="font-size: 20px;"></p>
								<p><button th:data-courseId="${list[c].courseId}"
								           th:data-userId="${list[c].userId}"
								           onclick="courseDelFunc(this)">삭제</button></p>
							</div>
							<!-- </a> -->
						</div>
					</div>
			</th:block>
			</div>
		</div>

					</div>
				</div>
			</section>
		</div>
		</th:block>


<!-- .main-content -->

<th:block layout:fragment="script">
	<script>
	
	//삭제 함수
	function courseDelFunc(obj){
      let userId =$(obj).attr('data-userId');
      let courseId =$(obj).attr('data-courseId');
	  let result = confirm("삭제하시겠습니까?");
	  console.log(userId);
	  console.log(courseId);
	  if(result) {
		  $.ajax({
			  url: "deleteCourse",
			  type:'DELETE',
			  data : JSON.stringify({ userId: userId,
                                      courseId:courseId }),
			  dataType:'json',
			  contentType:'application/json;charset="UTF-8"',
			  success:function(result){
				  if(result==true){
					  alert("코스가 삭제 되었습니다.")
					  actionForm.submit();
				  }    
			  },
			  error:function(){
			  }
		  })//ajax end==
	  }  
	}
	
		$(function() {
			//세션 아이디 쓰기
			let userSessionId = userSession == null ? "" : userSession.userId;
			
			var actionForm = $("#actionForm")
			
/* 		   		$.ajax({
	    			url: "",
	    			method : "post",
	    			data : JSON.stringify({ userId: userSessionId,
	    			                     }),
	    			//async : false, //아이작스 끝나야 다음이 실행됨 동기식
	    			dataType : "json",
	    			contentType : "application/json;charset=UTF-8",
	    			success: function(datas){
	    				let placeTag = "";
	    				for(data of datas){
	    					placeTag ="<i>"+data.placeName+"</i>"
	    					$("#"+data.courseId).append(placeTag)
	    				}
	    			},
	    			error : function(){
	    				
	    			}
	    		}) */
	    	  
		           
			  //상세보기
		/*      $(".move").on("click", function(e){
		        e.preventDefault();
		        var bno= $(this).attr("href")
		        actionForm.append('<input type="hidden" name="bno" value="'+bno+'">')
		        actionForm.attr("action","get")
		        actionForm.submit();
		      }) */
		      
		      //페이징 클릭
		      $(".pull-right a").on("click", function(e){
		        e.preventDefault(); //a,submit 기본기능 막기
		    	var p = $(this).attr("href");
		    	$('[name="pageNum"]').val(p);
		    	actionForm.submit();
		      });
		      
		      //분류 검색
		      $("select[name=category]").on("change", function(){
			    actionForm.submit();
		      });

		     
		});/* script function 끝! */
	</script>
</th:block>
</html>